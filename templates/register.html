<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register Business Owner - Simple Books</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-size: 0.85rem;
      background-color: #f8f9fa;
    }
    .card-main {
      max-width: 500px;
      border-radius: 0.7rem;
      box-shadow: 0 1px 8px rgba(0,0,0,0.07);
      margin: auto;
      padding: 1.2rem !important;
    }
    .btn-indigo {
      background-color: #4f46e5;
      color: #fff;
      font-weight: 600;
      border-radius: 0.35rem;
      border: none;
      font-size: 0.92rem;
      padding: 0.4rem 0;
    }
    .btn-indigo:hover {
      background-color: #4338ca;
    }
    .form-label {
      font-weight: 500;
      color: #374151;
      font-size: 0.92rem;
      margin-bottom: 0.15rem;
    }
    .form-control {
      font-size: 0.85rem;
      padding: 0.3rem 0.5rem;
      border-radius: 0.3rem;
      min-height: 1.8rem;
    }
    .form-control:focus {
      box-shadow: 0 0 0 0.15rem rgba(99, 102, 241, 0.13);
      border-color: #6366f1;
    }
    .branch-remove-btn {
      font-size: 1rem;
      color: #dc3545;
      background: none;
      border: none;
      padding: 0 0.3rem;
      cursor: pointer;
      line-height: 1;
    }
    .flash-message {
      font-size: 0.85rem;
      padding: 0.18rem 0.5rem;
      border-radius: 0.3rem;
      margin-bottom: 0.3rem;
    }
    h2 {
      font-size: 1.25rem;
      margin-bottom: 0.7rem !important;
    }
    .text-secondary {
      font-size: 0.92rem;
      margin-bottom: 0.7rem !important;
    }
    .btn-link {
      font-size: 0.8rem !important;
      padding: 0 !important;
    }
    .gap-2 {
      gap: 0.4rem !important;
    }
    .mb-2, .mb-3 {
      margin-bottom: 0.6rem !important;
    }
    .mt-3 {
      margin-top: 1rem !important;
    }
    .py-2 {
      padding-top: 0.4rem !important;
      padding-bottom: 0.4rem !important;
    }
    .mt-2 {
      margin-top: 0.5rem !important;
    }
  </style>
</head>
<body class="bg-light min-vh-100 d-flex align-items-center justify-content-center">
  <div class="card card-main bg-white">
    <h2 class="text-center fw-bold" style="color: #4f46e5;">
      <i class="bi bi-person-plus me-2"></i>Register Business Owner
    </h2>
    <p class="text-center text-secondary">
      Create your account to manage your organization and branches.
    </p>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div>
          {% for category, message in messages %}
            <div class="flash-message alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'info' }}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    <form action="{{ url_for('register') }}" method="POST" onsubmit="return validateForm()">
      <div class="row g-2">
        <div class="col-md-6">
          <div class="mb-2">
            <label for="username" class="form-label">Username</label>
            <input type="text" id="username" name="username" class="form-control" required>
          </div>
          <div class="mb-2">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" name="email" class="form-control">
          </div>
          <div class="mb-2">
            <label for="password" class="form-label">Password</label>
            <input type="password" id="password" name="password" class="form-control" required>
          </div>
          <div class="mb-2">
            <label for="confirm_password" class="form-label">Confirm Password</label>
            <input type="password" id="confirm_password" name="confirm_password" class="form-control" required>
            <div id="passwordMatchMessage" class="small mt-1"></div>
          </div>
          <div class="mb-2">
            <label for="admin_password" class="form-label">Admin Password</label>
            <input type="password" id="admin_password" name="admin_password" class="form-control" required>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-2">
            <label for="organization" class="form-label">Organization</label>
            <input type="text" id="organization" name="organization" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Branches / Locations</label>
            <div id="branchFields" class="d-grid gap-2">
              <div class="d-flex align-items-center gap-2">
                <input type="text" name="branches" placeholder="Enter branch / location" class="form-control" required />
              </div>
            </div>
            <button type="button" onclick="addBranchField()" class="btn btn-link text-decoration-none text-primary">
              + Add another branch / location
            </button>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <button type="submit" class="btn btn-indigo w-100 fw-semibold">
          Register Business Owner
        </button>
        <a href="{{ url_for('login') }}" class="btn btn-secondary w-100 mt-2">
          Already have an account? Login
        </a>
      </div>
    </form>
  </div>
  <script>
    function addBranchField() {
      const container = document.getElementById("branchFields");
      const wrapper = document.createElement("div");
      wrapper.className = "d-flex align-items-center gap-2";
      const input = document.createElement("input");
      input.type = "text";
      input.name = "branches";
      input.placeholder = "Enter branch";
      input.className = "form-control";
      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.className = "branch-remove-btn";
      removeBtn.innerHTML = "&times;";
      removeBtn.onclick = function() {
        container.removeChild(wrapper);
      };
      wrapper.appendChild(input);
      wrapper.appendChild(removeBtn);
      container.appendChild(wrapper);
    }
    // Password match validation
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirm_password");
    const message = document.getElementById("passwordMatchMessage");
    confirmPassword.addEventListener("input", function() {
      if (confirmPassword.value === "") {
        message.textContent = "";
        return;
      }
      if (password.value === confirmPassword.value) {
        message.textContent = "Passwords match";
        message.className = "text-success small mt-1";
      } else {
        message.textContent = "Passwords do not match";
        message.className = "text-danger small mt-1";
      }
    });
    function validateForm() {
      if (password.value !== confirmPassword.value) {
        alert("Passwords do not match!");
        return false;
      }
      const branchInputs = document.querySelectorAll('input[name="branches"]');
      let hasBranch = false;
      branchInputs.forEach(input => {
        if (input.value.trim() !== "") {
          hasBranch = true;
        }
      });
      if (!hasBranch) {
        alert("Please enter at least one branch.");
        return false;
      }
      return true;
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>